---

import { pool } from "../../lib/db.js";
import Layout from "../../layouts/Layout.astro"; 

export async function getStaticPaths() {
  const [rows] = await pool.query("SELECT id FROM especialidades");
  return rows.map((esp: { id: any; }) => ({
    params: { id: String(esp.id) },
  }));
}
const { id } = Astro.params;
const [especialidadRows] = await pool.query(
  "SELECT id, nombre, descripcion FROM especialidades WHERE id = ?",
  [id]
);

if (especialidadRows.length === 0) {
  throw new Error("Especialidad no encontrada");
}

const especialidad = especialidadRows[0];
const [especialistas] = await pool.query(
  `SELECT e.id, e.nombre, e.apellido, e.correo, e.telefono
   FROM especialistas e
   WHERE e.especialidad_id = ?`,
  [id]
);
---
<Layout title="Especialidades">
    <section class="p-6">
    <h1 class="text-3xl font-bold text-blue-600 mb-4">
        {especialidad.nombre}
    </h1>
    <p class="text-gray-700 mb-6">{especialidad.descripcion}</p>

    <h2 class="text-2xl font-semibold mb-3">Especialistas disponibles</h2>

    {especialistas.length > 0 ? (
        <ul class="space-y-4">
        {especialistas.map((esp: { nombre: string; apellido: string; email: string; telefono: string; }) => (
            <li class="p-4 border rounded-lg shadow-sm hover:shadow-md transition">
            <h3 class="text-lg font-bold">{esp.nombre} {esp.apellido}</h3>
            {esp.email && <p class="text-gray-600">{esp.email}</p>}
            {esp.telefono && <p class="text-gray-600">{esp.telefono}</p>}
            </li>
        ))}
        </ul>
    ) : (
        <p class="text-gray-500">No hay especialistas registrados para esta especialidad.</p>
    )}
    </section>
</Layout>
