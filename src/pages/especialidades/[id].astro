---
export const prerender = false;
import { pool } from "../../lib/db.js";
import Layout from "../../layouts/Layout.astro"; 
import type { RowDataPacket } from "mysql2/promise";

interface Especialidad extends RowDataPacket {
  id: number;
  nombre: string;
  descripcion: string;
}

interface Especialista extends RowDataPacket {
  id: number;
  nombre: string;
  apellido: string;
  correo: string;
  telefono: string;
}

export async function getStaticPaths() {
  const [rows] = await pool.query<RowDataPacket[]>(
    "SELECT id FROM especialidades"
  );
  return (rows as Especialidad[]).map((esp) => ({
    params: { id: String(esp.id) },
  }));
}

const { id } = Astro.params;

const [especialidadRows] = await pool.query<RowDataPacket[]>(
  "SELECT id, nombre, descripcion FROM especialidades WHERE id = ?",
  [id]
);

const especialidades = especialidadRows as Especialidad[];

if (especialidades.length === 0) {
  throw new Error("Especialidad no encontrada");
}

const especialidad = especialidades[0];

const [especialistaRows] = await pool.query<RowDataPacket[]>(
  `SELECT e.id, e.nombre, e.apellido, e.correo, e.telefono
   FROM especialistas e
   WHERE e.especialidad_id = ?`,
  [id]
);

const especialistas = especialistaRows as Especialista[];
---

<Layout title={especialidad.nombre}>
  <section class="p-6 max-w-6xl mx-auto">
    
    <h1 class="text-3xl md:text-4xl font-bold text-blue-600 mb-4 text-center md:text-left">
      {especialidad.nombre}
    </h1>
    <p class="text-gray-700 mb-6 text-base md:text-lg text-center md:text-left">
      {especialidad.descripcion}
    </p>

    <h2 class="text-2xl md:text-3xl font-semibold mb-4 text-center md:text-left">
      Especialistas disponibles
    </h2>

    {especialistas.length > 0 ? (
      <ul class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {especialistas.map((esp) => (
          <li class="p-4 border rounded-xl shadow-sm hover:shadow-md transition bg-white">
            <h3 class="text-lg md:text-xl font-bold text-gray-800">
              {esp.nombre} {esp.apellido}
            </h3>
            {esp.correo && (
              <p class="text-gray-600 text-sm md:text-base">{esp.correo}</p>
            )}
            {esp.telefono && (
              <p class="text-gray-600 text-sm md:text-base">{esp.telefono}</p>
            )}
          </li>
        ))}
      </ul>
    ) : (
      <p class="text-gray-500 text-center md:text-left">
        No hay especialistas registrados para esta especialidad.
      </p>
    )}
  </section>
</Layout>
